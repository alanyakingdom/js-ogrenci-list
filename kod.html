<!DOCTYPE html>
<html lang="tr" id="mainHtml" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WEBTUG - AMP 11 A</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = { darkMode: 'class' }
    </script>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 min-h-screen transition-colors duration-300 font-sans">

    <div id="modalOverlay" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 w-full max-w-md rounded-[2rem] p-8 border dark:border-gray-700 shadow-2xl">
            <div class="flex justify-between items-center mb-6">
                <h3 class="font-black text-xl italic">Yeni Ã–ÄŸrenci KaydÄ±</h3>
                <button id="closeModal" class="text-gray-400 hover:text-red-500 text-2xl">&times;</button>
            </div>
            <form id="studentForm" class="space-y-4">
                <input type="text" id="formAd" placeholder="Ad Soyad" required class="w-full p-3 rounded-xl bg-gray-50 dark:bg-gray-900 border dark:border-gray-700 outline-none focus:ring-2 focus:ring-blue-500">
                <input type="text" id="formNo" placeholder="Okul No" required class="w-full p-3 rounded-xl bg-gray-50 dark:bg-gray-900 border dark:border-gray-700 outline-none focus:ring-2 focus:ring-blue-500">
                <button type="submit" class="w-full py-3 bg-blue-600 text-white rounded-xl font-bold shadow-lg shadow-blue-500/30">LÄ°STEYE EKLE</button>
            </form>
        </div>
    </div>

    <header class="p-6 border-b dark:border-gray-800 flex justify-between items-center max-w-6xl mx-auto">
        <div>
            <h1 class="text-xl font-mono font-bold tracking-tighter text-blue-600 uppercase italic">WEBTUG - AMP 11 A</h1>
            <p class="text-[10px] text-gray-400 uppercase tracking-widest leading-none mt-1">Sinav Projesi</p>
        </div>
        
        <div class="flex gap-2">
            <button id="apiFetchBtn" class="px-4 py-2 rounded-xl border border-blue-600 text-blue-600 font-bold text-[10px] hover:bg-blue-600 hover:text-white transition-all uppercase tracking-tighter">API Verisi Ekle</button>
            <button id="openModal" class="px-4 py-2 rounded-xl bg-blue-600 text-white font-bold text-[10px] hover:scale-105 transition-all shadow-lg shadow-blue-500/20 uppercase tracking-tighter">+ Yeni KayÄ±t</button>
            <button id="themeToggle" class="p-2 rounded-xl bg-gray-50 dark:bg-gray-800 border dark:border-gray-700">
                <span class="dark:hidden">ğŸŒ™</span><span class="hidden dark:inline">â˜€ï¸</span>
            </button>
        </div>
    </header>

    <main class="max-w-6xl mx-auto p-6">
        
        <div class="mb-8 flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4">
            <div>
                <h2 class="text-2xl font-black italic">Ã–ÄŸrenciler</h2>
                <span id="studentCount" class="text-[10px] font-bold bg-blue-600 text-white px-3 py-1 rounded-full uppercase tracking-tighter">0 KayÄ±t</span>
            </div>
            <input type="text" id="searchInput" placeholder="Ä°sim veya No ile ara..." 
                   class="w-full sm:w-64 p-2.5 rounded-xl bg-gray-50 dark:bg-gray-800 border dark:border-gray-700 outline-none focus:ring-2 focus:ring-blue-500 text-sm">
        </div>

        <div id="studentGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
            </div>

        <div id="loader" class="hidden text-center py-10 animate-pulse text-blue-600 font-mono text-xs uppercase tracking-widest">
            Sunucudan veri Ã§ekiliyor...
        </div>

    </main>

    <script>
        // --- 1. HAFIZA VE VERÄ° YÃ–NETÄ°MÄ° ---
        // LocalStorage'dan veriyi al, yoksa boÅŸ dizi baÅŸlat
        let ogrenciler = JSON.parse(localStorage.getItem('sinifHafizasi')) || [];

        const grid = document.getElementById('studentGrid');
        const countSpan = document.getElementById('studentCount');
        const loader = document.getElementById('loader');

        // Veriyi kaydedip ekranÄ± gÃ¼ncelleyen ana fonksiyon
        function updateUI(liste = ogrenciler) {
            localStorage.setItem('sinifHafizasi', JSON.stringify(ogrenciler));
            render(liste);
        }

        function render(liste) {
            grid.innerHTML = "";
            countSpan.innerText = `${liste.length} Ã–ÄRENCÄ°`;

            liste.forEach((o, index) => {
                const card = document.createElement('div');
                card.className = "group shadow-md bg-white dark:bg-gray-800 border dark:border-gray-700 p-5 rounded-[2rem] hover:shadow-xl transition-all duration-300 relative overflow-hidden";
                
                card.innerHTML = `
                    <button onclick="deleteStudent(${index})" class="absolute top-4 right-4 text-gray-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-all z-30">âœ•</button>
                    <div class="relative shadow-xl w-32 h-32 mb-5 bg-gray-50 dark:bg-gray-900 rounded-full overflow-hidden border-2 border-transparent group-hover:border-blue-500 transition-colors mx-auto">
                        <img src="${o.avatarNormal}" class="absolute inset-0 w-full h-full object-cover transition-all duration-500 z-20 group-hover:opacity-0 group-hover:-translate-y-8">
                        <img src="${o.avatarHover}" class="absolute inset-0 w-full h-full object-cover transition-all duration-500 z-10 opacity-0 scale-95 translate-y-8 group-hover:opacity-100 group-hover:translate-y-0">
                    </div>
                    <div class="space-y-0.5 text-left w-full">
                        <h3 class="font-black text-xl leading-tight group-hover:text-blue-600 transition-colors uppercase italic">${o.adSoyad}</h3>
                        <p class="text-sm font-bold text-blue-500 font-mono tracking-tighter">Okul No: ${o.no}</p>
                        <div class="mt-3 pt-3 border-t dark:border-gray-700">
                            <p class="text-[13px] text-gray-400 leading-tight">BiliÅŸim Teknolojileri</p>
                            <p class="text-[13px] font-bold text-slate-800 dark:text-slate-200 leading-tight italic">YazÄ±lÄ±m GeliÅŸtirme DalÄ±</p>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        // --- 2. FETCH API (DÄ±ÅŸarÄ±dan Ä°sim ve No Ã‡ekme) ---
        async function fetchNewStudent() {
            loader.classList.remove('hidden');
            try {
                const res = await fetch('https://randomuser.me/api/');
                const data = await res.json();
                const person = data.results[0];

                const apiStudent = {
                    adSoyad: `${person.name.first} ${person.name.last}`.toUpperCase(),
                    no: Math.floor(1000 + Math.random() * 9000).toString(),
                    avatarNormal: `https://api.dicebear.com/7.x/avataaars/svg?seed=${person.login.uuid}&translateY=50`,
                    avatarHover: `https://api.dicebear.com/7.x/avataaars/svg?seed=${person.login.uuid}&translateY=0`
                };

                ogrenciler.push(apiStudent);
                updateUI();
            } catch (err) {
                console.error("Veri Ã§ekilemedi", err);
            } finally {
                loader.classList.add('hidden');
            }
        }

        // --- 3. OLAYLAR VE FORM ---
        document.getElementById('studentForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const ad = document.getElementById('formAd').value;
            const no = document.getElementById('formNo').value;
            
            ogrenciler.push({
                adSoyad: ad.toUpperCase(),
                no: no,
                avatarNormal: `https://api.dicebear.com/7.x/avataaars/svg?seed=${no}&translateY=50`,
                avatarHover: `https://api.dicebear.com/7.x/avataaars/svg?seed=${no}&translateY=0`
            });
            
            updateUI();
            document.getElementById('studentForm').reset();
            document.getElementById('modalOverlay').classList.add('hidden');
        });

        // Silme Ä°ÅŸlemi
        window.deleteStudent = (idx) => {
            ogrenciler.splice(idx, 1);
            updateUI();
        };

        // Modal ve Tema Kontrolleri
        document.getElementById('openModal').onclick = () => document.getElementById('modalOverlay').classList.remove('hidden');
        document.getElementById('closeModal').onclick = () => document.getElementById('modalOverlay').classList.add('hidden');
        document.getElementById('themeToggle').onclick = () => document.getElementById('mainHtml').classList.toggle('dark');
        document.getElementById('apiFetchBtn').onclick = fetchNewStudent;

        // Arama
        document.getElementById('searchInput').oninput = (e) => {
            const t = e.target.value.toLowerCase();
            render(ogrenciler.filter(o => o.adSoyad.toLowerCase().includes(t) || o.no.includes(t)));
        };

        // BaÅŸlangÄ±Ã§
        updateUI();
    </script>
</body>
</html>
